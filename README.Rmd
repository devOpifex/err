---
output: 
  github_document:
    html_preview: false
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

<!-- badges: start -->
<!-- badges: end -->

# err

Error handling for R, inspired by Go's standard library; it makes it easier to standardise and handle error messages, doing so also forces the developer to think about errors rather than let them happen.

## Installation

``` r
# install.packages("remotes")
remotes::install_github("devOpifex/err")
```

## Examples

Errors and warning can either be created from strings or warning and error objects.

```{r}
library(err)

err <- e("Something went wrong")

foo <- function(...){
  tryCatch(
    ..., 
    error = function(err) e(err), 
    warning = function(war) w(war) 
  )
}

foo(log("a"))
foo(matrix(1:3, nrow = 2))
```

Templates that are used to print errors and warnings can be customised.

```{r}
tmpl.e("Whoops: %s - sorry!")

e("Sumin' went wrong")
```

You can also retrieve the message of the error or warning.

```{r}
war <- w("Careful")

(string <- war$message())

class(string)
```

One can check whether the object returned is an error or a warning.

```{r}
x <- tryCatch(print(error), error = function(err) e(err))

is.e(x)
```

The function `jab` is analogous to `tryCatch` but will use `err` internally. It also allows passing `e` and `w` along to easily reuse error messages.

```{r, error=TRUE}
safe_log <- function(x){
 result <- jab(log(x))
 
 if(is.e(result))
   stop(result$message())

 return(result)
} 

safe_log("a")
```

Instead of checking the results of `tryCatch` with an `if` statement, one might want to use `enforce` which will check whether the result is an error or a warning and deal with it accordingly (`stop` or `warning`).

```{r, error=TRUE}
err <- e("Log only accepts numeric(s)")

safe_log <- function(x){
 result <- jab(log(x), e = err)
 enforce(result)

 return(result)
} 

safe_log("a")
```

The `enforce` function accepts multiple objects, note that these are evaluated in order.

```{r, error=FALSE}
x <- "just a string"
www <- w("Caution")
err <- e("Broken!")

enforce(x, www, err)
```
